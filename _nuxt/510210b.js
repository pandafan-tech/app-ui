(window.webpackJsonp=window.webpackJsonp||[]).push([[10,6],{1138:function(e,t,n){var o=n(1166);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,n(2).default)("7aac2ac1",o,!0,{sourceMap:!1})},1165:function(e,t,n){"use strict";n(1138)},1166:function(e,t,n){var o=n(1)(!1);o.push([e.i,'.arrow[data-v-1d5e5f7a],.arrow[data-v-1d5e5f7a]:before{position:absolute}.arrow[data-v-1d5e5f7a]{top:70%;left:30%;margin:-20px 0 0 -20px;-webkit-transform:rotate(45deg);border-right:2px solid #fff;border-top:2px solid #fff}.arrow[data-v-1d5e5f7a],.arrow[data-v-1d5e5f7a]:before{width:20px;height:20px;border-left:none}.arrow[data-v-1d5e5f7a]:before{content:"";top:50%;margin:-10px 0 0 -10px;border-right:1px solid #fff;border-top:1px solid #fff;-webkit-animation-duration:1.5s;animation-duration:1.5s;-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-name:arrow-data-v-1d5e5f7a;animation-name:arrow-data-v-1d5e5f7a}@-webkit-keyframes arrow-data-v-1d5e5f7a{0%{opacity:0;transform:translate(-2px,2px)}50%{opacity:1}to{opacity:0;transform:translate(13px,-13px)}}@keyframes arrow-data-v-1d5e5f7a{0%{opacity:0;transform:translate(-2px,2px)}50%{opacity:1}to{opacity:0;transform:translate(13px,-13px)}}',""]),e.exports=o},1167:function(e,t,n){var o=n(1225);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,n(2).default)("4587d552",o,!0,{sourceMap:!1})},1185:function(e,t,n){"use strict";n.r(t);n(1165);var o=n(51),r=Object(o.a)({},(function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"arrow"})}),[],!1,null,"1d5e5f7a",null);t.default=r.exports},1224:function(e,t,n){"use strict";n(1167)},1225:function(e,t,n){var o=n(1)(!1);o.push([e.i,".connections-control{position:fixed!important;bottom:0;left:0;width:100%;height:3.2rem;padding:0}.connections-control .connect-button{border-radius:0;font-size:1.6rem;width:100%}",""]),e.exports=o},1251:function(e,t,n){"use strict";n.r(t);n(9),n(63),n(75),n(28),n(74);var o=n(6),r=(n(105),n(1123)),a=n(19),c=n(1185);window.onerror=function(e,t,n,o,r){console.log("Exception: ",r.message.startsWith("EPERM:"))};var i={components:{Arrow:c.default},data:function(){return{connectButtonLoading:!1,connectButtonDisabled:!1}},computed:{connectButtonText:function(){return this.connected?this.$t("disconnect"):this.$t("connect")}},methods:{connectAction:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,r,c,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.connectButtonLoading=!0,n=e.connected?"disconnect":"connect","darwin"!==a.remote.process.platform){t.next=24;break}if(o="".concat(a.remote.app.getPath("userData"),"/ProxyConfig"),t.prev=4,r=a.remote.require("fs-extra"),c=r.fstatSync(r.openSync(o)),console.log("ProxyConfig perm is:",c),0===c.uid){t.next=19;break}return console.log("UID is not root. will force reinstall helper."),t.prev=10,t.next=13,r.remove(o);case 13:console.log("ProxyConfig deleted."),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(10),console.log("delete ProxyConfig failed:",t.t0);case 19:t.next=24;break;case 21:t.prev=21,t.t1=t.catch(4),console.log("ready perm of ProxyConfig failed",t.t1);case 24:if(console.log("performing action: "+n),"connect"!==n){t.next=29;break}if(e.runTimeState.selected_line&&e.runTimeState.selected_line.name){t.next=29;break}return e.connectButtonLoading=!1,t.abrupt("return",e.$message({message:e.$t("connect_info.select_line"),type:"error"}));case 29:return t.prev=29,t.next=32,e[n]();case 32:t.next=38;break;case 34:t.prev=34,t.t2=t.catch(29),console.log("---\x3e>> action failed:",t.t2),["connect timeout","disconnect timeout"].includes(t.t2.message)?e.$message({message:e.$t("error.timeout"),type:"error"}):((i=e.shouldIgnoreError(t.t2)).ignore?(console.log("will not report to sentry."),console.log("matched error:",i.matchedError)):e.$sentry.captureException(t.t2),s=e.errorMessageAssemble(t.t2),console.table(t.t2),"EPERM"===i.matchedError&&(s+="<br>".concat(e.$t("error.eperm"))),["ENOENT","UNKNOWN"].includes(i.matchedError)&&("darwin"===a.remote.process.platform?s+="<br>".concat(e.$t("error.enoent")):"win32"===a.remote.process.platform&&("ia32"===a.remote.process.arch?s+="<br>".concat(e.$t("error.clash")):s+="<br>".concat(e.$t("error.missing")))),"Command failed"===i.matchedError&&(s+="<br>".concat(e.$t("error.restart"))),e.$alert(s,e.$t("error.connect_failed"),{confirmButtonText:"OK",dangerouslyUseHTMLString:!0}).catch((function(){})));case 38:e.connectButtonLoading=!1;case 39:case"end":return t.stop()}}),t,null,[[4,21],[10,16],[29,34]])})))()},connect:function(){var e=this;return this.runTimeState.show_access_mode||this.$store.dispatch("runTimeState",{servermode:"auto"}),new Promise((function(t,n){var o=setTimeout((function(){n(new Error("connect timeout"))}),8e3);a.ipcRenderer.once("connect-reply",(function(c,i){if(console.log(i),Object(r.clearTimeout)(o),i.failed)console.log("connect failed:",i.reason),n(i.reason);else{var s={line:JSON.parse(JSON.stringify(e.runTimeState.selected_line)),servermode:e.runTimeState.servermode,status:"connected"};e.$store.dispatch("runTimeState",{connect_state:s}),a.ipcRenderer.send("user-info-update",4),t(i)}})),a.ipcRenderer.send("connect",e.runTimeState.selected_line.name)}))},disconnect:function(){var e=this;return new Promise((function(t,n){var o=setTimeout((function(){n(new Error("disconnect timeout"))}),5e3);a.ipcRenderer.once("disconnect-reply",(function(c,i){if(console.log("dis reply--\x3e>",i),Object(r.clearTimeout)(o),i.failed)return console.log("gonna trorw an error"),console.log("disconnect failed:",i.reason),n(i.reason);var s={line:{},servermode:e.runTimeState.servermode,status:"disconnected"};e.$store.dispatch("runTimeState",{connect_state:s}),a.ipcRenderer.send("user-info-update",5),t(i)})),a.ipcRenderer.send("disconnect",e.runTimeState.selected_line.name)}))}}},s=(n(1224),n(51)),l=Object(s.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-row",{staticClass:"connections-control"},[n("el-button",{staticClass:"connect-button",attrs:{type:"connected"==e.runTimeState.connect_state.status?"warning":"success",loading:e.connectButtonLoading,disabled:e.connectButtonDisabled||e.connectButtonLoading},on:{click:e.connectAction}},[e._v(" "+e._s(e.connectButtonText))])],1)}),[],!1,null,null,null);t.default=l.exports}}]);