(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{1184:function(x,L,r){"use strict";r.d(L,"a",function(){return M});var u=r(144);function _(O){if(Array.isArray(O))return Object(u.a)(O)}var $=r(209),T=r(109);function b(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M(O){return _(O)||Object($.a)(O)||Object(T.a)(O)||b()}},1278:function(x,L,r){var u=r(33);x.exports=function(_,$){if(!u(_)||_._t!==$)throw TypeError("Incompatible receiver, "+$+" required!");return _}},1279:function(x,L,r){var u=r(1446);u.__esModule&&(u=u.default),typeof u=="string"&&(u=[[x.i,u,""]]),u.locals&&(x.exports=u.locals);var _=r(2).default,$=_("e8542948",u,!0,{sourceMap:!1})},1442:function(x,L,r){"use strict";var u=r(1443),_=r(1278),$="Set";x.exports=r(1444)($,function(T){return function(){return T(this,arguments.length>0?arguments[0]:void 0)}},{add:function(b){return u.def(_(this,$),b=b===0?0:b,b)}},u)},1443:function(x,L,r){"use strict";var u=r(28).f,_=r(143),$=r(318),T=r(65),b=r(316),M=r(317),O=r(213),C=r(320),S=r(214),z=r(19),B=r(315).fastKey,R=r(1278),j=z?"_s":"size",F=function(g,v){var m=B(v),o;if(m!=="F")return g._i[m];for(o=g._f;o;o=o.n)if(o.k==v)return o};x.exports={getConstructor:function(g,v,m,o){var h=g(function(s,l){b(s,h,v,"_i"),s._t=v,s._i=_(null),s._f=void 0,s._l=void 0,s[j]=0,l!=null&&M(l,m,s[o],s)});return $(h.prototype,{clear:function(){for(var l=R(this,v),p=l._i,d=l._f;d;d=d.n)d.r=!0,d.p&&(d.p=d.p.n=void 0),delete p[d.i];l._f=l._l=void 0,l[j]=0},delete:function(s){var l=R(this,v),p=F(l,s);if(p){var d=p.n,e=p.p;delete l._i[p.i],p.r=!0,e&&(e.n=d),d&&(d.p=e),l._f==p&&(l._f=d),l._l==p&&(l._l=e),l[j]--}return!!p},forEach:function(l){R(this,v);for(var p=T(l,arguments.length>1?arguments[1]:void 0,3),d;d=d?d.n:this._f;)for(p(d.v,d.k,this);d&&d.r;)d=d.p},has:function(l){return!!F(R(this,v),l)}}),z&&u(h.prototype,"size",{get:function(){return R(this,v)[j]}}),h},def:function(g,v,m){var o=F(g,v),h,s;return o?o.v=m:(g._l=o={i:s=B(v,!0),k:v,v:m,p:h=g._l,n:void 0,r:!1},g._f||(g._f=o),h&&(h.n=o),g[j]++,s!=="F"&&(g._i[s]=o)),g},getEntry:F,setStrong:function(g,v,m){O(g,v,function(o,h){this._t=R(o,v),this._k=h,this._l=void 0},function(){for(var o=this,h=o._k,s=o._l;s&&s.r;)s=s.p;return!o._t||!(o._l=s=s?s.n:o._t._f)?(o._t=void 0,C(1)):h=="keys"?C(0,s.k):h=="values"?C(0,s.v):C(0,[s.k,s.v])},m?"entries":"values",!m,!0),S(v)}}},1444:function(x,L,r){"use strict";var u=r(12),_=r(10),$=r(34),T=r(318),b=r(315),M=r(317),O=r(316),C=r(33),S=r(20),z=r(212),B=r(108),R=r(216);x.exports=function(j,F,g,v,m,o){var h=u[j],s=h,l=m?"set":"add",p=s&&s.prototype,d={},e=function(i){var c=p[i];$(p,i,i=="delete"?function(w){return o&&!C(w)?!1:c.call(this,w===0?0:w)}:i=="has"?function(D){return o&&!C(D)?!1:c.call(this,D===0?0:D)}:i=="get"?function(D){return o&&!C(D)?void 0:c.call(this,D===0?0:D)}:i=="add"?function(D){return c.call(this,D===0?0:D),this}:function(D,E){return c.call(this,D===0?0:D,E),this})};if(typeof s!="function"||!(o||p.forEach&&!S(function(){new s().entries().next()})))s=v.getConstructor(F,j,m,l),T(s.prototype,g),b.NEED=!0;else{var n=new s,t=n[l](o?{}:-0,1)!=n,a=S(function(){n.has(1)}),y=z(function(i){new s(i)}),f=!o&&S(function(){for(var i=new s,c=5;c--;)i[l](c,c);return!i.has(-0)});y||(s=F(function(i,c){O(i,s,j);var w=R(new h,i,s);return c!=null&&M(c,m,w[l],w),w}),s.prototype=p,p.constructor=s),(a||f)&&(e("delete"),e("has"),m&&e("get")),(f||t)&&e(l),o&&p.clear&&delete p.clear}return B(s,j),d[j]=s,_(_.G+_.W+_.F*(s!=h),d),o||v.setStrong(s,j,m),s}},1445:function(x,L,r){"use strict";var u=r(1279),_=r.n(u)},1446:function(x,L,r){var u=r(1),_=u(!1);_.push([x.i,".proxy-rules-container{height:100vh;padding:2rem .5rem .5rem;position:relative;max-width:100vw;color:#f4f7fc}.proxy-rules-container ol{padding-left:0;margin-bottom:1rem}.proxy-rules-container ol li{margin-left:1rem}.proxy-rules-container ol li code{padding:.5rem;text-decoration:underline}.proxy-rules-container .el-button{margin-bottom:2rem}.proxy-rules-container h2{font-weight:500}.proxy-rules-container .el-row{margin-bottom:2rem}.proxy-rules-container .el-transfer{width:100%;margin:20px auto}.proxy-rules-container .el-transfer-panel{width:45%}.proxy-rules-container .el-transfer__buttons{width:10%}.proxy-rules-container .el-transfer__buttons .el-transfer__button{margin:10px auto}.proxy-rules-container .top-space{margin-top:1rem}.proxy-rules-container .info-content,.proxy-rules-container .info-header{color:#34495e;margin-bottom:.5rem;line-height:1.2}.proxy-rules-container .info-header{color:#7f8c8d}.proxy-rules-container .info-header h3{font-weight:400}.proxy-rules-container .large-button{font-size:1.5rem}.proxy-rules-container .dashboard-link,.proxy-rules-container .mode-switch{position:fixed;bottom:.5rem;z-index:999}.proxy-rules-container .dashboard-link{right:.5rem}.proxy-rules-container .mode-switch{left:.5rem}.proxy-rules-container .menu-link{font-size:2rem;text-decoration:none;width:100%;display:block;margin-top:.5rem;padding-left:.5rem}.proxy-rules-container .menu-link:hover{background:#1abc9c;color:#fff}",""]),x.exports=_},1482:function(x,L,r){"use strict";r.r(L);var u=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"proxy-rules-container"},[t("h2",[e._v(e._s(e.$t("settings_page.proxy_list.mode-switch."+e.editMode)))]),e.editMode=="domain-mode"?t("div",[t("el-row",[t("ol",[t("h2",[e._v(e._s(e.$t("settings_page.proxy_list.usage.title")))]),t("li",[e._v(e._s(e.$t("settings_page.proxy_list.usage.a")))]),t("li",[e._v(e._s(e.$t("settings_page.proxy_list.usage.b")))]),t("li",[e._v(e._s(e.$t("settings_page.proxy_list.usage.c.a"))),t("code",[e._v("foo.com")]),e._v(e._s(e.$t("settings_page.proxy_list.usage.c.b"))),t("code",[e._v("foo.com")]),e._v(","),t("code",[e._v("www.foo.com")]),e._v(","),t("code",[e._v("bar.www.foo.com")]),e._v(e._s(e.$t("settings_page.proxy_list.usage.c.c"))),t("code",[e._v("foo.com")]),e._v(e._s(e.$t("settings_page.proxy_list.usage.c.d")))]),t("li",[e._v(e._s(e.$t("settings_page.proxy_list.usage.d")))])])]),t("el-row",[t("h3",[e._v(e._s(e.$t("settings_page.proxy_list.exclude.right.title")))]),t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:20},placeholder:e.$t("settings_page.proxy_list.exclude.right.title")},model:{value:e.user_exclude_str,callback:function(a){e.user_exclude_str=a},expression:"user_exclude_str"}})],1),t("el-row",[t("h3",[e._v(e._s(e.$t("settings_page.proxy_list.include.right.title")))]),t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:20},placeholder:e.$t("settings_page.proxy_list.include.right.title")},model:{value:e.user_include_str,callback:function(a){e.user_include_str=a},expression:"user_include_str"}})],1),t("el-button",{staticClass:"full-width",attrs:{type:"primary"},nativeOn:{click:function(a){return e.save.apply(null,arguments)}}},[e._v(e._s(e.$t("settings_page.proxy_list.save-button")))])],1):e._e(),e.editMode=="rule-mode"?t("div",[e.runTimeState.connect_state.status=="connected"?t("div",[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-transfer",{attrs:{filterable:"","render-content":e.renderContent,data:e.proxyDomainListForTransfer,titles:[e.$t("settings_page.proxy_list.exclude.left.title"),e.$t("settings_page.proxy_list.exclude.right.title")]},on:{change:e.transferred},model:{value:e.user_exclude,callback:function(a){e.user_exclude=a},expression:"user_exclude"}})],1)],1),t("el-divider"),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-transfer",{attrs:{filterable:"","render-content":e.renderContent,data:e.directDomainListForTransfer,titles:[e.$t("settings_page.proxy_list.include.left.title"),e.$t("settings_page.proxy_list.include.right.title")]},on:{change:e.transferred},model:{value:e.user_include,callback:function(a){e.user_include=a},expression:"user_include"}})],1)],1)],1):t("div",[t("h2",[e._v("\u4F7F\u7528\u8BE5\u6A21\u5F0F\u7F16\u8F91\u8BF7\u5148\u8FDE\u63A5\u4E00\u6761\u7EBF\u8DEF")])])]):e._e(),t("nuxt-link",{staticClass:"dashboard-link",attrs:{to:"/dashboard/settings/"}},[e._v(" "+e._s(e.$t("back")))])],1)},_=[],$=r(23),T=r(24),b=r(40),M=r(75),O=r(6),C=r(77),S=r(1184),z=r(47),B=r(22),R=r(9),j=r(48),F=r(1442),g=r(142),v=r(64),m=r(76),o={middleware:["load-rt-data"],data:function(){return{rawlogs:{},user_include:null,user_exclude:null,editMode:"domain-mode",dirtyData:!1,hostnameReg:/^https?\:\/\/([^\/:?#]+)(?:[\/:?#]|$)/i}},computed:{proxyName:function(){return this.rawlogs.proxy},stdout:function(){return this.rawlogs.stdout},stderr:function(){return this.rawlogs.stderr},records:function(){if(!this.stderr)return{};console.log("filtering proxy domains...");var n=this.stderr.reduce(function(t,a){if(a.includes("<->")&&!a.includes("error in dial")){var y=a.trim().split(/\s+/),f=y[y.length-1],i=y[6].split(":")[0];f==="DIRECT"?t.direct.add(i):t.proxied.add(i)}return t},{proxied:new Set,direct:new Set});return n},proxiedDomainList:function(){return Array.from(this.records.proxied||[])},directDomainList:function(){return Array.from(this.records.direct||[])},user_exclude_str:{get:function(){var n;return(n=this.user_exclude)===null||n===void 0?void 0:n.join(`
`)},set:function(n){this.dirtyData=!0,this.user_exclude=n==null?void 0:n.split(`
`).reduce(this.textEditSetMangle,[])}},user_include_str:{get:function(){var n;return(n=this.user_include)===null||n===void 0?void 0:n.join(`
`)},set:function(n){this.dirtyData=!0,this.user_include=n==null?void 0:n.split(`
`).reduce(this.textEditSetMangle,[])}},proxyDomainListForTransfer:function(){var n,t,a=this,y=this.proxiedDomainList.reduce(function(i,c){return i.push({key:c,label:c,disabled:!1}),i},[]),f=(((n=this.current_service)===null||n===void 0||(t=n.extra)===null||t===void 0?void 0:t.user_exclude)||"").split(",").reduce(function(i,c){return a.proxiedDomainList.includes(c)||i.push({key:c,label:c,disabled:!1}),i},[]);return Object(S.a)(new Set(f.concat(y)))},directDomainListForTransfer:function(){var n,t,a=this,y=this.directDomainList.reduce(function(i,c){return i.push({key:c,label:c,disabled:!1}),i},[]),f=(((n=this.current_service)===null||n===void 0||(t=n.extra)===null||t===void 0?void 0:t.user_include)||"").split(",").reduce(function(i,c){return a.directDomainList.includes(c)||i.push({key:c,label:c,disabled:!1}),i},[]);return Object(S.a)(new Set(f.concat(y)))}},created:function(){console.log("proxy-rules created"),this.initUserList()},beforeDestroy:function(){},methods:{byteHelper:function(n){var t=["b","kB","MB","GB","TB"],a=Math.floor(Math.log(n)/Math.log(1024));return(n/Math.pow(1024,Math.floor(a))).toFixed(1)+" "+t[a]},renderContent:function(n,t){return n("span",{domProps:{title:t.label}},t.label)},initUserList:function(){var n,t,a,y,f,i;this.user_exclude=((n=this.current_service)===null||n===void 0||(t=n.extra)===null||t===void 0||(a=t.user_exclude)===null||a===void 0?void 0:a.split(","))||[],this.user_include=((y=this.current_service)===null||y===void 0||(f=y.extra)===null||f===void 0||(i=f.user_include)===null||i===void 0?void 0:i.split(","))||[],this.dirtyData=!1},switchEditMode:function(){var n=this;if(!this.dirtyData)return this.doEditModeSwitch();this.$confirm(this.$t("settings_page.proxy_list.mode-switch.dirtydata_warning.msg"),this.$t("settings_page.proxy_list.mode-switch.dirtydata_warning.title"),{confirmButtonText:this.$t("settings_page.proxy_list.mode-switch.dirtydata_warning.confirm_button"),cancelButtonText:this.$t("settings_page.proxy_list.mode-switch.dirtydata_warning.cancel_button"),type:"warning"}).then(function(){n.doEditModeSwitch()}).catch(function(){})},doEditModeSwitch:function(){this.editMode==="rule-mode"?this.editMode="domain-mode":this.editMode="rule-mode",this.initUserList()},textEditSetMangle:function(n,t){return n.push(t.toLowerCase().replace(/^https?:\/\//g,"").replace(/(:|\/).*/g,"")),n},checkFormat:function(n,t){return t=t.toLowerCase().replace(/^https?:\/\//g,"").replace(/(:|\/).*/g,""),n.push(t),n},transferred:function(n,t,a){this.dirtyData=!0,console.log(arguments)},save:function(){var n=this;return Object(O.a)(regeneratorRuntime.mark(function t(){var a;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return console.log("eeee"),a={service_cate:n.current_service.cate,service_id:n.current_service.id,include:n.user_include_str.split(`
`).filter(function(i){return i.length}).reduce(n.checkFormat,[]).join(","),exclude:n.user_exclude_str.split(`
`).filter(function(i){return i.length}).reduce(n.checkFormat,[]).join(",")},console.log("opt--->",a),f.prev=3,f.next=6,n.$store.dispatch("updateProxyDomainList",a);case 6:n.$message({message:n.$t("settings_page.proxy_list.success"),type:"success"}),f.next=13;break;case 9:f.prev=9,f.t0=f.catch(3),console.log(f.t0),n.$message({message:n.$t("settings_page.proxy_list.failed")+f.t0.message||f.t0.toString(),type:"error"});case 13:case"end":return f.stop()}},t,null,[[3,9]])}))()}}},h=o,s=r(1445),l=r(51),p=Object(l.a)(h,u,_,!1,null,null,null),d=L.default=p.exports}}]);
