(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{1278:function(m,w,s){var f=s(33);m.exports=function(p,j){if(!f(p)||p._t!==j)throw TypeError("Incompatible receiver, "+j+" required!");return p}},1279:function(m,w,s){var f=s(1447);f.__esModule&&(f=f.default),typeof f=="string"&&(f=[[m.i,f,""]]),f.locals&&(m.exports=f.locals);var p=s(2).default,j=p("e8542948",f,!0,{sourceMap:!1})},1443:function(m,w,s){"use strict";var f=s(1444),p=s(1278),j="Set";m.exports=s(1445)(j,function(S){return function(){return S(this,arguments.length>0?arguments[0]:void 0)}},{add:function(O){return f.def(p(this,j),O=O===0?0:O,O)}},f)},1444:function(m,w,s){"use strict";var f=s(29).f,p=s(145),j=s(319),S=s(66),O=s(317),B=s(318),F=s(214),b=s(321),T=s(215),M=s(19),z=s(316).fastKey,C=s(1278),$=M?"_s":"size",R=function(g,_){var x=z(_),o;if(x!=="F")return g._i[x];for(o=g._f;o;o=o.n)if(o.k==_)return o};m.exports={getConstructor:function(g,_,x,o){var h=g(function(n,l){O(n,h,_,"_i"),n._t=_,n._i=p(null),n._f=void 0,n._l=void 0,n[$]=0,l!=null&&B(l,x,n[o],n)});return j(h.prototype,{clear:function(){for(var l=C(this,_),v=l._i,d=l._f;d;d=d.n)d.r=!0,d.p&&(d.p=d.p.n=void 0),delete v[d.i];l._f=l._l=void 0,l[$]=0},delete:function(n){var l=C(this,_),v=R(l,n);if(v){var d=v.n,e=v.p;delete l._i[v.i],v.r=!0,e&&(e.n=d),d&&(d.p=e),l._f==v&&(l._f=d),l._l==v&&(l._l=e),l[$]--}return!!v},forEach:function(l){C(this,_);for(var v=S(l,arguments.length>1?arguments[1]:void 0,3),d;d=d?d.n:this._f;)for(v(d.v,d.k,this);d&&d.r;)d=d.p},has:function(l){return!!R(C(this,_),l)}}),M&&f(h.prototype,"size",{get:function(){return C(this,_)[$]}}),h},def:function(g,_,x){var o=R(g,_),h,n;return o?o.v=x:(g._l=o={i:n=z(_,!0),k:_,v:x,p:h=g._l,n:void 0,r:!1},g._f||(g._f=o),h&&(h.n=o),g[$]++,n!=="F"&&(g._i[n]=o)),g},getEntry:R,setStrong:function(g,_,x){F(g,_,function(o,h){this._t=C(o,_),this._k=h,this._l=void 0},function(){for(var o=this,h=o._k,n=o._l;n&&n.r;)n=n.p;return!o._t||!(o._l=n=n?n.n:o._t._f)?(o._t=void 0,b(1)):h=="keys"?b(0,n.k):h=="values"?b(0,n.v):b(0,[n.k,n.v])},x?"entries":"values",!x,!0),T(_)}}},1445:function(m,w,s){"use strict";var f=s(12),p=s(10),j=s(34),S=s(319),O=s(316),B=s(318),F=s(317),b=s(33),T=s(20),M=s(213),z=s(110),C=s(217);m.exports=function($,R,g,_,x,o){var h=f[$],n=h,l=x?"set":"add",v=n&&n.prototype,d={},e=function(i){var u=v[i];j(v,i,i=="delete"?function(L){return o&&!b(L)?!1:u.call(this,L===0?0:L)}:i=="has"?function(D){return o&&!b(D)?!1:u.call(this,D===0?0:D)}:i=="get"?function(D){return o&&!b(D)?void 0:u.call(this,D===0?0:D)}:i=="add"?function(D){return u.call(this,D===0?0:D),this}:function(D,P){return u.call(this,D===0?0:D,P),this})};if(typeof n!="function"||!(o||v.forEach&&!T(function(){new n().entries().next()})))n=_.getConstructor(R,$,x,l),S(n.prototype,g),O.NEED=!0;else{var r=new n,t=r[l](o?{}:-0,1)!=r,a=T(function(){r.has(1)}),y=M(function(i){new n(i)}),c=!o&&T(function(){for(var i=new n,u=5;u--;)i[l](u,u);return!i.has(-0)});y||(n=R(function(i,u){F(i,n,$);var L=C(new h,i,n);return u!=null&&B(u,x,L[l],L),L}),n.prototype=v,v.constructor=n),(a||c)&&(e("delete"),e("has"),x&&e("get")),(c||t)&&e(l),o&&v.clear&&delete v.clear}return z(n,$),d[$]=n,p(p.G+p.W+p.F*(n!=h),d),o||_.setStrong(n,$,x),n}},1446:function(m,w,s){"use strict";var f=s(1279),p=s.n(f)},1447:function(m,w,s){var f=s(1),p=f(!1);p.push([m.i,".proxy-rules-container{height:100vh;padding:2rem .5rem .5rem;position:relative;max-width:100vw;color:#f4f7fc}.proxy-rules-container ol{padding-left:0;margin-bottom:1rem}.proxy-rules-container ol li{margin-left:1rem}.proxy-rules-container ol li code{padding:.5rem;text-decoration:underline}.proxy-rules-container .el-button{margin-bottom:2rem}.proxy-rules-container h2{font-weight:500}.proxy-rules-container .el-row{margin-bottom:2rem}.proxy-rules-container .el-transfer{width:100%;margin:20px auto}.proxy-rules-container .el-transfer-panel{width:45%}.proxy-rules-container .el-transfer__buttons{width:10%}.proxy-rules-container .el-transfer__buttons .el-transfer__button{margin:10px auto}.proxy-rules-container .top-space{margin-top:1rem}.proxy-rules-container .info-content,.proxy-rules-container .info-header{color:#34495e;margin-bottom:.5rem;line-height:1.2}.proxy-rules-container .info-header{color:#7f8c8d}.proxy-rules-container .info-header h3{font-weight:400}.proxy-rules-container .large-button{font-size:1.5rem}.proxy-rules-container .dashboard-link,.proxy-rules-container .mode-switch{position:fixed;bottom:.5rem;z-index:999}.proxy-rules-container .dashboard-link{right:.5rem}.proxy-rules-container .mode-switch{left:.5rem}.proxy-rules-container .menu-link{font-size:2rem;text-decoration:none;width:100%;display:block;margin-top:.5rem;padding-left:.5rem}.proxy-rules-container .menu-link:hover{background:#1abc9c;color:#fff}",""]),m.exports=p},1485:function(m,w,s){"use strict";s.r(w);var f=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"proxy-rules-container"},[t("h2",[e._v(e._s(e.$t("settings_page.proxy_list.mode-switch."+e.editMode)))]),e.editMode=="domain-mode"?t("div",[t("el-row",[t("ol",[t("h2",[e._v(e._s(e.$t("settings_page.proxy_list.usage.title")))]),t("li",[e._v(e._s(e.$t("settings_page.proxy_list.usage.a")))]),t("li",[e._v(e._s(e.$t("settings_page.proxy_list.usage.b")))]),t("li",[e._v(e._s(e.$t("settings_page.proxy_list.usage.c.a"))),t("code",[e._v("foo.com")]),e._v(e._s(e.$t("settings_page.proxy_list.usage.c.b"))),t("code",[e._v("foo.com")]),e._v(","),t("code",[e._v("www.foo.com")]),e._v(","),t("code",[e._v("bar.www.foo.com")]),e._v(e._s(e.$t("settings_page.proxy_list.usage.c.c"))),t("code",[e._v("foo.com")]),e._v(e._s(e.$t("settings_page.proxy_list.usage.c.d")))]),t("li",[e._v(e._s(e.$t("settings_page.proxy_list.usage.d")))])])]),t("el-row",[t("h3",[e._v(e._s(e.$t("settings_page.proxy_list.exclude.right.title")))]),t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:20},placeholder:e.$t("settings_page.proxy_list.exclude.right.title")},model:{value:e.user_exclude_str,callback:function(a){e.user_exclude_str=a},expression:"user_exclude_str"}})],1),t("el-row",[t("h3",[e._v(e._s(e.$t("settings_page.proxy_list.include.right.title")))]),t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:20},placeholder:e.$t("settings_page.proxy_list.include.right.title")},model:{value:e.user_include_str,callback:function(a){e.user_include_str=a},expression:"user_include_str"}})],1),t("el-button",{staticClass:"full-width",attrs:{type:"primary"},nativeOn:{click:function(a){return e.save.apply(null,arguments)}}},[e._v(e._s(e.$t("settings_page.proxy_list.save-button")))])],1):e._e(),e.editMode=="rule-mode"?t("div",[e.runTimeState.connect_state.status=="connected"?t("div",[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-transfer",{attrs:{filterable:"","render-content":e.renderContent,data:e.proxyDomainListForTransfer,titles:[e.$t("settings_page.proxy_list.exclude.left.title"),e.$t("settings_page.proxy_list.exclude.right.title")]},on:{change:e.transferred},model:{value:e.user_exclude,callback:function(a){e.user_exclude=a},expression:"user_exclude"}})],1)],1),t("el-divider"),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-transfer",{attrs:{filterable:"","render-content":e.renderContent,data:e.directDomainListForTransfer,titles:[e.$t("settings_page.proxy_list.include.left.title"),e.$t("settings_page.proxy_list.include.right.title")]},on:{change:e.transferred},model:{value:e.user_include,callback:function(a){e.user_include=a},expression:"user_include"}})],1)],1)],1):t("div",[t("h2",[e._v("\u4F7F\u7528\u8BE5\u6A21\u5F0F\u7F16\u8F91\u8BF7\u5148\u8FDE\u63A5\u4E00\u6761\u7EBF\u8DEF")])])]):e._e(),t("nuxt-link",{staticClass:"dashboard-link",attrs:{to:"/dashboard/settings/"}},[e._v(" "+e._s(e.$t("back")))])],1)},p=[],j=s(23),S=s(24),O=s(40),B=s(76),F=s(6),b=s(65),T=s(212),M=s(47),z=s(22),C=s(9),$=s(48),R=s(1443),g=s(144),_=s(64),x=s(77),o={middleware:["load-rt-data"],data:function(){return{rawlogs:{},user_include:null,user_exclude:null,editMode:"domain-mode",dirtyData:!1,hostnameReg:/^https?\:\/\/([^\/:?#]+)(?:[\/:?#]|$)/i}},computed:{proxyName:function(){return this.rawlogs.proxy},stdout:function(){return this.rawlogs.stdout},stderr:function(){return this.rawlogs.stderr},records:function(){if(!this.stderr)return{};console.log("filtering proxy domains...");var r=this.stderr.reduce(function(t,a){if(a.includes("<->")&&!a.includes("error in dial")){var y=a.trim().split(/\s+/),c=y[y.length-1],i=y[6].split(":")[0];c==="DIRECT"?t.direct.add(i):t.proxied.add(i)}return t},{proxied:new Set,direct:new Set});return r},proxiedDomainList:function(){return Array.from(this.records.proxied||[])},directDomainList:function(){return Array.from(this.records.direct||[])},user_exclude_str:{get:function(){var r;return(r=this.user_exclude)===null||r===void 0?void 0:r.join(`
`)},set:function(r){this.dirtyData=!0,this.user_exclude=r==null?void 0:r.split(`
`).reduce(this.textEditSetMangle,[])}},user_include_str:{get:function(){var r;return(r=this.user_include)===null||r===void 0?void 0:r.join(`
`)},set:function(r){this.dirtyData=!0,this.user_include=r==null?void 0:r.split(`
`).reduce(this.textEditSetMangle,[])}},proxyDomainListForTransfer:function(){var r,t,a=this,y=this.proxiedDomainList.reduce(function(i,u){return i.push({key:u,label:u,disabled:!1}),i},[]),c=(((r=this.current_service)===null||r===void 0||(t=r.extra)===null||t===void 0?void 0:t.user_exclude)||"").split(",").reduce(function(i,u){return a.proxiedDomainList.includes(u)||i.push({key:u,label:u,disabled:!1}),i},[]);return Object(T.a)(new Set(c.concat(y)))},directDomainListForTransfer:function(){var r,t,a=this,y=this.directDomainList.reduce(function(i,u){return i.push({key:u,label:u,disabled:!1}),i},[]),c=(((r=this.current_service)===null||r===void 0||(t=r.extra)===null||t===void 0?void 0:t.user_include)||"").split(",").reduce(function(i,u){return a.directDomainList.includes(u)||i.push({key:u,label:u,disabled:!1}),i},[]);return Object(T.a)(new Set(c.concat(y)))}},created:function(){console.log("proxy-rules created"),this.initUserList()},beforeDestroy:function(){},methods:{byteHelper:function(r){var t=["b","kB","MB","GB","TB"],a=Math.floor(Math.log(r)/Math.log(1024));return(r/Math.pow(1024,Math.floor(a))).toFixed(1)+" "+t[a]},renderContent:function(r,t){return r("span",{domProps:{title:t.label}},t.label)},initUserList:function(){var r,t,a,y,c,i;this.user_exclude=((r=this.current_service)===null||r===void 0||(t=r.extra)===null||t===void 0||(a=t.user_exclude)===null||a===void 0?void 0:a.split(","))||[],this.user_include=((y=this.current_service)===null||y===void 0||(c=y.extra)===null||c===void 0||(i=c.user_include)===null||i===void 0?void 0:i.split(","))||[],this.dirtyData=!1},switchEditMode:function(){var r=this;if(!this.dirtyData)return this.doEditModeSwitch();this.$confirm(this.$t("settings_page.proxy_list.mode-switch.dirtydata_warning.msg"),this.$t("settings_page.proxy_list.mode-switch.dirtydata_warning.title"),{confirmButtonText:this.$t("settings_page.proxy_list.mode-switch.dirtydata_warning.confirm_button"),cancelButtonText:this.$t("settings_page.proxy_list.mode-switch.dirtydata_warning.cancel_button"),type:"warning"}).then(function(){r.doEditModeSwitch()}).catch(function(){})},doEditModeSwitch:function(){this.editMode==="rule-mode"?this.editMode="domain-mode":this.editMode="rule-mode",this.initUserList()},textEditSetMangle:function(r,t){return r.push(t.toLowerCase().replace(/^https?:\/\//g,"").replace(/(:|\/).*/g,"")),r},checkFormat:function(r,t){return t=t.toLowerCase().replace(/^https?:\/\//g,"").replace(/(:|\/).*/g,""),r.push(t),r},transferred:function(r,t,a){this.dirtyData=!0,console.log(arguments)},save:function(){var r=this;return Object(F.a)(regeneratorRuntime.mark(function t(){var a;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return console.log("eeee"),a={service_cate:r.current_service.cate,service_id:r.current_service.id,include:r.user_include_str.split(`
`).filter(function(i){return i.length}).reduce(r.checkFormat,[]).join(","),exclude:r.user_exclude_str.split(`
`).filter(function(i){return i.length}).reduce(r.checkFormat,[]).join(",")},console.log("opt--->",a),c.prev=3,c.next=6,r.$store.dispatch("updateProxyDomainList",a);case 6:r.$message({message:r.$t("settings_page.proxy_list.success"),type:"success"}),c.next=13;break;case 9:c.prev=9,c.t0=c.catch(3),console.log(c.t0),r.$message({message:r.$t("settings_page.proxy_list.failed")+c.t0.message||c.t0.toString(),type:"error"});case 13:case"end":return c.stop()}},t,null,[[3,9]])}))()}}},h=o,n=s(1446),l=s(51),v=Object(l.a)(h,f,p,!1,null,null,null),d=w.default=v.exports}}]);
